# ======================================
# Core Application - Docker Environment Configuration
# ======================================
# Copy this file to .env and configure for your environment
#
# IMPORTANT: Never commit .env to version control!
#
# This file contains all environment variables for Docker deployment
# For development: use docker-compose.dev.yml (most values have defaults)
# For production:  use docker-compose.prod.yml (REQUIRED values marked)
#
# ======================================

# =====================================
# ENVIRONMENT
# =====================================
# Environment: development | staging | production
NODE_ENV=production

# =====================================
# APPLICATION
# =====================================
# Application port (internal container port)
APP_PORT=14102

# Application URL (external access URL)
# Example: https://myapp.example.com
APP_URL=http://localhost:14102

# Frontend URL for CORS configuration
# Example: https://myapp.example.com (same as APP_URL if served together)
FRONTEND_URL=http://localhost:14100

# API URL passed to frontend build
FRONTEND_API_URL=http://localhost:14102/api/v1

# =====================================
# DATABASE (PostgreSQL) - REQUIRED
# =====================================
# Database credentials
# REQUIRED: Change these for production!
DB_USER=postgres
DB_PASSWORD=your_secure_database_password_here
DB_NAME=core_app

# Database SSL (recommended for production)
DB_SSL=false

# External port mapping (host:container)
DB_EXTERNAL_PORT=14101

# Connection pool settings
DB_POOL_MAX=20
DB_POOL_IDLE_TIMEOUT_MS=30000
DB_POOL_CONNECTION_TIMEOUT_MS=2000

# =====================================
# REDIS
# =====================================
# External port mapping
REDIS_EXTERNAL_PORT=14103

# =====================================
# JWT AUTHENTICATION - REQUIRED
# =====================================
# REQUIRED: JWT secret key (minimum 32 characters)
# Generate with: openssl rand -base64 32
JWT_SECRET=your_super_secret_jwt_key_change_this_in_production_min_32_chars

# Token expiration times
JWT_EXPIRES_IN=24h
JWT_REFRESH_EXPIRES_IN=30d
JWT_ACCESS_EXPIRY=15m
JWT_REFRESH_EXPIRY_SHORT=24h
JWT_REFRESH_EXPIRY_LONG=30d

# Token cleanup interval (milliseconds)
TOKEN_CLEANUP_INTERVAL_MS=3600000

# =====================================
# PASSWORD SECURITY
# =====================================
# BCrypt rounds for password hashing (10-14 recommended)
BCRYPT_ROUNDS=12

# =====================================
# EMAIL (Resend.com) - REQUIRED FOR PRODUCTION
# =====================================
# REQUIRED: Resend API key (get from https://resend.com)
RESEND_API_KEY=re_your_api_key_here

# Email sender configuration
EMAIL_FROM_NAME=Core Application
EMAIL_FROM_ADDRESS=noreply@yourdomain.com

# Support email for internal notifications
SUPPORT_EMAIL=support@yourdomain.com

# Email retry configuration
EMAIL_MAX_RETRIES=3
EMAIL_RETRY_DELAY_MS=1000

# =====================================
# EMAIL QUEUE
# =====================================
# Enable async email queue
EMAIL_QUEUE_ENABLED=true

# Queue processing interval (milliseconds)
EMAIL_QUEUE_PROCESS_INTERVAL=5000

# Retry settings
EMAIL_RETRY_MAX=3
EMAIL_RETRY_DELAY=5000

# Rate limit (emails per minute)
EMAIL_RATE_LIMIT=60

# Company logo URL for email templates
COMPANY_LOGO_URL=

# =====================================
# RATE LIMITING
# =====================================
# Global rate limiting
RATE_LIMIT_TTL=60
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX=100
RATE_LIMIT_MAX_REQUESTS=100

# =====================================
# FEEDBACK
# =====================================
FEEDBACK_USE_QUEUE=true
FEEDBACK_QUEUE_PRIORITY=normal
FEEDBACK_RATE_LIMIT_MAX=5
FEEDBACK_RATE_LIMIT_WINDOW_SECONDS=3600
EMAIL_QUEUE_RETRY_ATTEMPTS=3

# =====================================
# LOGGING
# =====================================
# Log level: debug | info | warn | error
LOG_LEVEL=info

# Log retention
LOG_MAX_FILES=30d
LOG_MAX_SIZE=50m

# External logging (optional)
SENTRY_DSN=

# =====================================
# AUDIT LOGGING
# =====================================
AUDIT_LOG_ENABLED=true
AUDIT_LOG_API_REQUESTS=false
AUDIT_LOG_READ_ONLY=false

# =====================================
# SWAGGER API DOCUMENTATION
# =====================================
# Disable in production for security
SWAGGER_ENABLED=false

# =====================================
# HEALTH CHECKS (002-REWORK-002)
# =====================================
# Health check endpoints:
#   - /api/health       - Full health check (database, SMTP, storage)
#   - /api/health/live  - Liveness probe (fast, < 100ms, no dependencies)
#   - /api/health/ready - Readiness probe (checks database connectivity)
#
# Kubernetes/Docker usage:
#   livenessProbe:   /api/health/live  (initialDelay: 5s, period: 10s)
#   readinessProbe:  /api/health/ready (initialDelay: 10s, period: 5s)

# SMTP health check (optional)
SMTP_HOST=
SMTP_PORT=587
SMTP_CHECK_TIMEOUT=5000

# Storage health check timeout
STORAGE_CHECK_TIMEOUT=5000

# =====================================
# MINIO OBJECT STORAGE - REQUIRED
# =====================================
# REQUIRED: Change credentials for production!
MINIO_ACCESS_KEY=your_minio_access_key
MINIO_SECRET_KEY=your_minio_secret_key

# MinIO ports
MINIO_API_PORT=14104
MINIO_CONSOLE_PORT=14105

# MinIO SSL
MINIO_USE_SSL=false

# MinIO console URL (for browser redirect)
MINIO_CONSOLE_URL=http://localhost:14105

# Bucket names
MINIO_BUCKET_UPLOADS=uploads
MINIO_BUCKET_LOGOS=logos
MINIO_BUCKET_FEEDBACK=feedback

# =====================================
# SESSION MANAGEMENT
# =====================================
DEFAULT_SESSION_TIMEOUT_MINUTES=30
DEFAULT_SHOW_TIMEOUT_WARNING=true
DEFAULT_WARNING_BEFORE_TIMEOUT_MINUTES=5

# =====================================
# PERMISSION SYSTEM
# =====================================
# Cache TTL (milliseconds)
PERMISSION_CACHE_TTL_MS=300000
PERMISSION_HIERARCHY_CACHE_TTL_MS=600000

# =====================================
# SETTINGS CACHE
# =====================================
SETTINGS_CACHE_TTL_MS=60000

# =====================================
# FEATURE TOGGLES
# =====================================
FEATURE_CACHE_TTL_MS=60000

# =====================================
# MFA (Multi-Factor Authentication)
# =====================================
# Issuer name for authenticator apps
MFA_ISSUER=CoreApp

# MFA temp token secret (optional, defaults to JWT_SECRET)
MFA_TEMP_TOKEN_SECRET=

# MFA temp token expiry (seconds)
MFA_TEMP_TOKEN_EXPIRY=300

# MFA lockout duration (seconds)
MFA_LOCKOUT_DURATION=900

# Max MFA attempts before lockout
MFA_MAX_ATTEMPTS=5

# =====================================
# INTERNATIONALIZATION (i18n)
# =====================================
DEFAULT_LANGUAGE=en
SUPPORTED_LANGUAGES=en,de
FALLBACK_LANGUAGE=en

# =====================================
# VERSION INFORMATION
# =====================================
# Set by CI/CD pipeline
BUILD_NUMBER=
GIT_COMMIT=

# =====================================
# USER REGISTRATION
# =====================================
VERIFICATION_TOKEN_EXPIRY=24h
REGISTRATION_RATE_LIMIT_MAX=3
REGISTRATION_RATE_LIMIT_WINDOW_SECONDS=3600

# =====================================
# FRONTEND (Port Configuration)
# =====================================
# HTTP port (redirect to HTTPS in production)
FRONTEND_HTTP_PORT=80

# HTTPS port
FRONTEND_HTTPS_PORT=443

# API port
API_PORT=14102

# =====================================
# BACKUP CONFIGURATION
# =====================================
# Days to keep backups
BACKUP_RETENTION_DAYS=30
